#!/bin/sh

set -e

HOMEBREW_REPO=https://github.com/Homebrew/brew.git
HOMEBREW_PREFIX=~/homebrew
HOMEBREW_CACHE=~/Library/Caches/Homebrew
HOMEBREW_NO_ANALYTICS=1 ## Ref https://github.com/Homebrew/brew/blob/9ebcef785eed097be709bffef97263b5f536ba34/docs/Analytics.md#opting-out
HOMEBREW_CASK_OPTS="--appdir=~/Applications"

P="$@"

test -e "$HOMEBREW_PREFIX" || ush -c "git clone $HOMEBREW_REPO $HOMEBREW_PREFIX"

S="set -e; env HOMEBREW_CACHE=\"${HOMEBREW_CACHE}\" HOMEBREW_EDITOR=\"${HOMEBREW_EDITOR}\" HOMEBREW_NO_ANALYTICS=\"${HOMEBREW_NO_ANALYTICS}\" HOMEBREW_CASK_OPTS=\"${HOMEBREW_CASK_OPTS}\" brew $P"
ush -c -p "${HOMEBREW_PREFIX}/bin:" "$S"

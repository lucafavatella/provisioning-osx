#!/bin/sh

REPO=https://github.com/bbatsov/prelude.git
FAKE_HOME="${HOME:?}"/.emacs-prelude.d
PRELUDE_DIR="${FAKE_HOME:?}"/.emacs.d
USER_CFG_DIR="${PRELUDE_DIR:?}"/personal

{
    test -e "${PRELUDE_DIR:?}" \
        || git clone --quiet "${REPO:?}" "${PRELUDE_DIR:?}"
} && {
    cat > "${USER_CFG_DIR:?}"/prelude-modules.el <<"EOF"
EOF
} && {
    ## Do not amend PATH, because Prelude
    ## [uses](https://github.com/bbatsov/prelude/blob/c951f8e52e7deed9463ca4630db992408ec9a956/core/prelude-macos.el#L37)
    ## package`exec-path-from-shell` that relies on the PATH as seen
    ## by the shell.
    env HOME="${FAKE_HOME:?}" emacs "$@"
}

#!/bin/sh

## Copyright (C) 2015 Luca Favatella <slackydeb@gmail.com>

set -e

log() {
    echo "[$(basename $0)] ${1:?}"
}

log_e() {
    log "${1:?}" >&2
}

ROOT_DIR="$(cd $(dirname $0)/.. && pwd)"

GIT_BUILD_IDS="${1:-OTP-19.1.4}" ## Overridden for extra installations and for testing.

log_e "You are supposed to have run not only '${ROOT_DIR}/bin/provision_osx' but also '${ROOT_DIR}/sbin/provision_osx_as_admin' (for 'javac')"
for GIT_BUILD_ID in $(echo "$GIT_BUILD_IDS" | tr ',' '\n'); do
    "${ROOT_DIR}/libexec/setup_home_kerl_installation" "$ROOT_DIR" "$GIT_BUILD_ID"
done
"${ROOT_DIR}/libexec/setup_home_otp" "$ROOT_DIR"

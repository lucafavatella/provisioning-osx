---
- hosts: localhost
  vars:
    managed_dotfiles:
      - .bash_profile
      - .tmux.conf
      - .gitconfig
      - .emacs
    managed_dirs:
      - dev ## dev(elopment)
      ##
      ## Ref http://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html#usrlocalLocalHierarchy
      - bin
    managed_bins_from_provisioning:
      - brew
    emacs_prelude_repo: https://github.com/bbatsov/prelude.git
    emacs_prelude_dir: "{{ home_prefix }}/.emacs-prelude.d/.emacs.d"

  tasks:

    ## Dotfiles e.g. ~/.*

    - git:
        repo={{ dotfiles_repo }} version=master
        dest={{ dotfiles_dir }} remote=provisioning-osx
        refspec=+refs/heads/master:refs/remotes/provisioning-osx/master
      with_sequence: count=2 ## HACK Update ref then checkout.

    - file:
        path={{ home_prefix }}/{{ item }}
        state=link
        src={{ dotfiles_dir }}/{{ item }}
      with_items: "{{ managed_dotfiles }}"

    ## Top directories e.g. ~/*

    - file:
        path={{ home_prefix }}/{{ item }}
        state=directory
      with_items: "{{ managed_dirs }}"

    - git:
        repo={{ emacs_prelude_repo }} version=master
        dest={{ emacs_prelude_dir }} remote=provisioning-osx
        refspec=+refs/heads/master:refs/remotes/provisioning-osx/master
      with_sequence: count=2 ## HACK Update ref then checkout.

    ## Binaries e.g. ~/bin/*

    - file:
        path={{ home_prefix }}/bin/{{ item }}
        state=link
        src={{ provisioning_osx_root_dir }}/bin/{{ item }}
      with_items: "{{ managed_bins_from_provisioning }}"

#!/bin/sh

## Copyright (C) 2015 Luca Favatella <slackydeb@gmail.com>

set -e

ROOT_DIR="$(cd $(dirname $0)/.. && pwd)"

brew cask install sizeup ## TODO Move to Spectacle https://www.spectacleapp.com - see also .osx

brew cask install Caskroom/versions/iterm2-beta ## No Sixel support (VT340) - [ref](https://gitlab.com/gnachman/iterm2/issues/3240).
brew install tmux
brew install bash-completion
brew install git ## For git-completion.
brew install emacs
(HOMEBREW_EDITOR="brew cat emacs | ${ROOT_DIR}/libexec/to_emacs-keg-only >" brew edit --force emacs-keg-only && brew install emacs-keg-only --devel --with-cocoa)

## Refs:
## * curl `-z`, curl `-w`: http://blog.yjl.im/2012/03/downloading-only-when-modified-using.html
## * `If-Modified-Since` HTTP header field: https://tools.ietf.org/html/rfc7232#section-3.3
## * `304` HTTP status code: https://tools.ietf.org/html/rfc7232#section-4.1
##
## In alternative to curl `-z <file>` option, modification date
## (mtime) of file could be retrieved using (non-POSIX) `stat`
## e.g. `stat -f '%Sm' -t '%Y%m%d%H%M%S' ...`.
##
## If curl `-z <date expression>` option needed, related standard for
## expressing time is RFC 5322.
FfC=$(curl -s -S -L --head -o /dev/null -w '%{http_code}' -z $(brew cask ls firefoxdeveloperedition | grep 'FirefoxDeveloperEdition.app.* -> .*FirefoxDeveloperEdition.app' | head -n1 | sed 's/ -> /@/' | cut -d '@' -f 2 | sed "s/^'\(.*\)'$/\1/")/Contents $(brew cask cat firefoxdeveloperedition | grep '^  url ' | head -n1 | sed "s/^  url '\(.*\)'$/\1/"))
case "$FfC" in
    304) echo "No more recent Firefox Developer Edition to install. Skipping." >&2;;
    200) brew cask install --force caskroom/versions/firefoxdeveloperedition;;
    *) echo "Check for Firefox Developer Edition returned unknown HTTP status code '${FfC}'. Exiting." >&2; exit 1
esac

#brew install packer
brew install docker
brew install docker-machine ## Downloads boot2docker.iso
brew install ansible
#brew install ssh-copy-id

#brew install android-platform-tools ## adb
#brew cask install android-studio ## From [IntelliJ IDEA and Android Studio FAQ](http://blog.jetbrains.com/idea/2013/05/intellij-idea-and-android-studio-faq/): "If Iâ€™m already a user of IntelliJ IDEA, do I need to switch to Android Studio for Android development? No. Android Studio is focused specifically on Android development and provides streamlined environment and project setup, but otherwise all of its features are available in IntelliJ IDEA."
brew install autoconf
brew install bats
brew install checkbashisms
#brew install cmake
#brew install dash
#brew install gcc
#brew install gdb
{ brew rm ctags || true; } && { { brew rm universal-ctags/universal-ctags/universal-ctags || true; } && brew install --HEAD universal-ctags/universal-ctags/universal-ctags; } && { brew install global --with-ctags --with-pygments || true; } ## HACK Using unofficial universal-ctags while using official global that depends on (exuberant-)ctags.
#brew install ghc cabal-install && PATH="$(brew --prefix)/bin:$PATH" cabal update && PATH="$(brew --prefix)/bin:$PATH" cabal install idris
#brew cask install caskroom/versions/intellij-idea-ce
brew install jq
brew install kerl
#brew install saitoha/sixel/mlterm ## Refs https://en.wikipedia.org/wiki/VT340 https://en.wikipedia.org/wiki/Sixel
#brew install node ## Installs `npm` too.
brew install openssl ## Install openssl - for building Erlang/OTP without skipping the crypto application [on MacOSX >= 10.11](http://erlang.org/pipermail/erlang-questions/2015-October/086386.html).
brew install p7zip ## `7z x` works as a compression-agnostic archive extractor command better than BSD `tar -x` e.g. for `gzip` compression.
#brew install plantuml
brew install pstree
#brew install pup
brew install python && "$(brew --prefix python)/bin/pip" install --upgrade pip setuptools ## Ref https://github.com/Homebrew/homebrew/blob/0333865e5d831faa6fd6a414fe19e486898aceba/Library/Formula/python.rb#L321-L322
brew install python3 && "$(brew --prefix python3)/bin/pip3" install --upgrade pip setuptools ## Ref https://github.com/Homebrew/homebrew/blob/cfcbf92dedb275bdf06597745d9dcd392dcb2fbb/Library/Formula/python3.rb#L314-L315
#brew install rust
#brew install shellcheck
brew install sqlite
#brew install valgrind
brew install watch
brew install wxmac ## Install wxWidgets - for building Erlang/OTP.

#brew install --with-deps dinkypumpkin/get_iplayer/get_iplayer

#brew cask install hipchat
#brew cask install libreoffice

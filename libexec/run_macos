#!/usr/bin/make -f

.DEFAULT_GOAL: run_macos

ifeq ($(origin ROOT_DIR), undefined)
$(error Undefined variable ROOT_DIR)
endif

REPO = https://github.com/lucafavatella/mathiasbynens-dotfiles.git
VERSION = c9a0dec

DIR = $(ROOT_DIR)/home/provisioning-osx.d/mathiasbynens-dotfiles
ORIGIN = provisioning-osx

.PHONY: run_macos
run_macos: $(DIR)/.macos
	$<

$(DIR)/.macos: | $(DIR)-$(VERSION) ;

.PHONY: $(DIR)-%
$(DIR)-%: | $(DIR)/.git
	-git -C $(DIR) fetch --quiet --all --prune --prune-tags --no-tags
	git -C $(DIR) reset --quiet --soft $*
	git -C $(DIR) stash --quiet --all

$(DIR)/.git: | $(DIR)
	git clone --quiet --origin $(ORIGIN) $(REPO) $(@D)

$(DIR):
	mkdir -p $@
